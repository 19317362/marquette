/**
 * jQuery plugin for Sortable
 * @author	RubaXa   <trash@rubaxa.org>
 * @license MIT
 */
(function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)})(function(t){"use strict";function e(t,e){this.el=t,this.options=e=e||{};var n={group:Math.random(),sort:!0,disabled:!1,store:null,handle:null,scroll:!0,scrollSensitivity:30,scrollSpeed:10,draggable:/[uo]l/i.test(t.nodeName)?"li":">*",ghostClass:"sortable-ghost",ignore:"a, img",filter:null,animation:0,setData:function(t,e){t.setData("Text",e.textContent)}};for(var o in n)!(o in e)&&(e[o]=n[o]);var r=e.group;r&&"object"==typeof r||(r=e.group={name:r}),["pull","put"].forEach(function(t){t in r||(r[t]=!0)}),j.forEach(function(n){e[n]=i(this,e[n]||M),a(t,n.substr(2).toLowerCase(),e[n])},this),t[B]=r.name+" "+(r.put.join?r.put.join(" "):"");for(var s in this)"_"===s.charAt(0)&&(this[s]=i(this,this[s]));a(t,"mousedown",this._onTapStart),a(t,"touchstart",this._onTapStart),Y&&a(t,"selectstart",this._onTapStart),a(t,"dragover",this._onDragOver),a(t,"dragenter",this._onDragOver),U.push(this._onDragOver),e.store&&this.sort(e.store.get(this))}function n(t){b&&b.state!==t&&(c(b,"display",t?"none":""),!t&&b.state&&y.insertBefore(b,m),b.state=t)}function i(t,e){var n=H.call(arguments,2);return e.bind?e.bind.apply(e,[t].concat(n)):function(){return e.apply(t,n.concat(H.call(arguments)))}}function o(t,e,n){if(t){n=n||I,e=e.split(".");var i=e.shift().toUpperCase(),o=RegExp("\\s("+e.join("|")+")\\s","g");do if(">*"===i&&t.parentNode===n||(""===i||t.nodeName==i)&&(!e.length||((" "+t.className+" ").match(o)||[]).length==e.length))return t;while(t!==n&&(t=t.parentNode))}return null}function r(t){t.dataTransfer.dropEffect="move",t.preventDefault()}function a(t,e,n){t.addEventListener(e,n,!1)}function s(t,e,n){t.removeEventListener(e,n,!1)}function l(t,e,n){if(t)if(t.classList)t.classList[n?"add":"remove"](e);else{var i=(" "+t.className+" ").replace(/\s+/g," ").replace(" "+e+" ","");t.className=i+(n?" "+e:"")}}function c(t,e,n){var i=t&&t.style;if(i){if(void 0===n)return I.defaultView&&I.defaultView.getComputedStyle?n=I.defaultView.getComputedStyle(t,""):t.currentStyle&&(n=t.currentStyle),void 0===e?n:n[e];e in i||(e="-webkit-"+e),i[e]=n+("string"==typeof n?"":"px")}}function h(t,e,n){if(t){var i=t.getElementsByTagName(e),o=0,r=i.length;if(n)for(;r>o;o++)n(i[o],o);return i}return[]}function d(t){t.draggable=!1}function f(){X=!1}function u(t,e){var n=t.lastElementChild,i=n.getBoundingClientRect();return e.clientY-(i.top+i.height)>5&&n}function p(t){for(var e=t.tagName+t.className+t.src+t.href+t.textContent,n=e.length,i=0;n--;)i+=e.charCodeAt(n);return i.toString(36)}function g(t){for(var e=0;t&&(t=t.previousElementSibling)&&"TEMPLATE"!==t.nodeName;)e++;return e}function v(t,e){var n,i;return function(){void 0===n&&(n=arguments,i=this,setTimeout(function(){1===n.length?t.call(i,n[0]):t.apply(i,n),n=void 0},e))}}var m,_,D,b,y,w,E,S,C,T,x,N,O={},B="Sortable"+(new Date).getTime(),A=window,I=A.document,R=A.parseInt,Y=!!I.createElement("div").dragDrop,X=!1,L=function(t,e,n,i,o,r){var a=I.createEvent("Event");a.initEvent(e,!0,!0),a.item=n||t,a.from=i||t,a.oldIndex=o,a.newIndex=r,t.dispatchEvent(a)},j="onAdd onUpdate onRemove onStart onEnd onFilter onSort".split(" "),M=function(){},W=Math.abs,H=[].slice,U=[];e.prototype={constructor:e,_dragStarted:function(){l(m,this.options.ghostClass,!0),e.active=this,L(y,"start",m,y,_)},_onTapStart:function(t){var e=t.type,n=t.touches&&t.touches[0],i=(n||t).target,r=i,s=this.options,l=this.el,f=s.filter;if(!("mousedown"===e&&0!==t.button||s.disabled)){if(s.handle&&(i=o(i,s.handle,l)),i=o(i,s.draggable,l),_=g(i),"function"==typeof f){if(f.call(this,t,i,this))return L(r,"filter",i,l,_),t.preventDefault(),void 0}else if(f&&(f=f.split(",").some(function(t){return t=o(r,t.trim(),l),t?(L(t,"filter",i,l,_),!0):void 0})))return t.preventDefault(),void 0;if(i&&!m&&i.parentNode===l){"selectstart"===e&&i.dragDrop(),x=t,y=this.el,m=i,E=m.nextSibling,T=this.options.group,m.draggable=!0,s.ignore.split(",").forEach(function(t){h(i,t.trim(),d)}),n&&(x={target:i,clientX:n.clientX,clientY:n.clientY},this._onDragStart(x,!0),t.preventDefault()),a(I,"mouseup",this._onDrop),a(I,"touchend",this._onDrop),a(I,"touchcancel",this._onDrop),a(m,"dragend",this),a(y,"dragstart",this._onDragStart),a(I,"dragover",this);try{I.selection?I.selection.empty():window.getSelection().removeAllRanges()}catch(u){}"clone"==T.pull&&(b=m.cloneNode(!0),c(b,"display","none"),y.insertBefore(b,m))}}},_emulateDragOver:function(){if(N){c(D,"display","none");var t=I.elementFromPoint(N.clientX,N.clientY),e=t,n=this.options.group.name,i=U.length;if(e)do{if((" "+e[B]+" ").indexOf(n)>-1){for(;i--;)U[i]({clientX:N.clientX,clientY:N.clientY,target:t,rootEl:e});break}t=e}while(e=e.parentNode);c(D,"display","")}},_onTouchMove:function(t){if(x){var e=t.touches[0],n=e.clientX-x.clientX,i=e.clientY-x.clientY,o="translate3d("+n+"px,"+i+"px,0)";N=e,c(D,"webkitTransform",o),c(D,"mozTransform",o),c(D,"msTransform",o),c(D,"transform",o),this._onDrag(e),t.preventDefault()}},_onDragStart:function(t,e){var n=t.dataTransfer,i=this.options;if(this._offUpEvents(),e){var o,r=m.getBoundingClientRect(),s=c(m);D=m.cloneNode(!0),c(D,"top",r.top-R(s.marginTop,10)),c(D,"left",r.left-R(s.marginLeft,10)),c(D,"width",r.width),c(D,"height",r.height),c(D,"opacity","0.8"),c(D,"position","fixed"),c(D,"zIndex","100000"),y.appendChild(D),o=D.getBoundingClientRect(),c(D,"width",2*r.width-o.width),c(D,"height",2*r.height-o.height),a(I,"touchmove",this._onTouchMove),a(I,"touchend",this._onDrop),a(I,"touchcancel",this._onDrop),this._loopId=setInterval(this._emulateDragOver,150)}else n&&(n.effectAllowed="move",i.setData&&i.setData.call(this,n,m)),a(I,"drop",this);if(w=i.scroll,w===!0){w=y;do if(w.offsetWidth<w.scrollWidth||w.offsetHeight<w.scrollHeight)break;while(w=w.parentNode)}setTimeout(this._dragStarted,0)},_onDrag:v(function(t){if(y&&this.options.scroll){var e,n,i=this.options,o=i.scrollSensitivity,r=i.scrollSpeed,a=t.clientX,s=t.clientY,l=window.innerWidth,c=window.innerHeight,h=(o>=l-a)-(o>=a),d=(o>=c-s)-(o>=s);h||d?e=A:w&&(e=w,n=w.getBoundingClientRect(),h=(o>=W(n.right-a))-(o>=W(n.left-a)),d=(o>=W(n.bottom-s))-(o>=W(n.top-s))),(O.vx!==h||O.vy!==d||O.el!==e)&&(O.el=e,O.vx=h,O.vy=d,clearInterval(O.pid),e&&(O.pid=setInterval(function(){e===A?A.scrollTo(A.scrollX+h*r,A.scrollY+d*r):(d&&(e.scrollTop+=d*r),h&&(e.scrollLeft+=h*r))},24)))}},30),_onDragOver:function(t){var e,i,r,a=this.el,s=this.options,l=s.group,h=l.put,d=T===l,p=s.sort;if(void 0!==t.preventDefault&&(t.preventDefault(),t.stopPropagation()),!X&&T&&(d?p||(r=!y.contains(m)):T.pull&&h&&(T.name===l.name||h.indexOf&&~h.indexOf(T.name)))&&(void 0===t.rootEl||t.rootEl===this.el)){if(e=o(t.target,s.draggable,a),i=m.getBoundingClientRect(),r)return n(!0),b||E?y.insertBefore(m,b||E):p||y.appendChild(m),void 0;if(0===a.children.length||a.children[0]===D||a===t.target&&(e=u(a,t))){if(e){if(e.animated)return;v=e.getBoundingClientRect()}n(d),a.appendChild(m),this._animate(i,m),e&&this._animate(v,e)}else if(e&&!e.animated&&e!==m&&void 0!==e.parentNode[B]){S!==e&&(S=e,C=c(e));var g,v=e.getBoundingClientRect(),_=v.right-v.left,w=v.bottom-v.top,x=/left|right|inline/.test(C.cssFloat+C.display),N=e.offsetWidth>m.offsetWidth,O=e.offsetHeight>m.offsetHeight,A=(x?(t.clientX-v.left)/_:(t.clientY-v.top)/w)>.5,I=e.nextElementSibling;X=!0,setTimeout(f,30),n(d),g=x?e.previousElementSibling===m&&!N||A&&N:I!==m&&!O||A&&O,g&&!I?a.appendChild(m):e.parentNode.insertBefore(m,g?I:e),this._animate(i,m),this._animate(v,e)}}},_animate:function(t,e){var n=this.options.animation;if(n){var i=e.getBoundingClientRect();c(e,"transition","none"),c(e,"transform","translate3d("+(t.left-i.left)+"px,"+(t.top-i.top)+"px,0)"),e.offsetWidth,c(e,"transition","all "+n+"ms"),c(e,"transform","translate3d(0,0,0)"),clearTimeout(e.animated),e.animated=setTimeout(function(){c(e,"transition",""),e.animated=!1},n)}},_offUpEvents:function(){s(I,"mouseup",this._onDrop),s(I,"touchmove",this._onTouchMove),s(I,"touchend",this._onDrop),s(I,"touchcancel",this._onDrop)},_onDrop:function(t){var n=this.el;if(clearInterval(this._loopId),clearInterval(O.pid),s(I,"drop",this),s(I,"dragover",this),s(n,"dragstart",this._onDragStart),this._offUpEvents(),t){if(t.preventDefault(),t.stopPropagation(),D&&D.parentNode.removeChild(D),m){s(m,"dragend",this);var i=g(m);d(m),l(m,this.options.ghostClass,!1),y!==m.parentNode?(L(m.parentNode,"sort",m,y,_,i),L(y,"sort",m,y,_,i),L(m,"add",m,y,_,i),L(y,"remove",m,y,_,i)):m.nextSibling!==E&&(L(y,"update",m,y,_,i),L(y,"sort",m,y,_,i),b&&b.parentNode.removeChild(b)),e.active&&L(y,"end",m,y,_,i)}y=m=D=E=b=x=N=S=C=T=e.active=null,this.save()}},handleEvent:function(t){var e=t.type;"dragover"===e?(this._onDrag(t),r(t)):("drop"===e||"dragend"===e)&&this._onDrop(t)},toArray:function(){for(var t,e=[],n=this.el.children,i=0,r=n.length;r>i;i++)t=n[i],o(t,this.options.draggable,this.el)&&e.push(t.getAttribute("data-id")||p(t));return e},sort:function(t){var e={},n=this.el;this.toArray().forEach(function(t,i){var r=n.children[i];o(r,this.options.draggable,n)&&(e[t]=r)},this),t.forEach(function(t){e[t]&&(n.removeChild(e[t]),n.appendChild(e[t]))})},save:function(){var t=this.options.store;t&&t.set(this)},closest:function(t,e){return o(t,e||this.options.draggable,this.el)},option:function(t,e){var n=this.options;return void 0===e?n[t]:(n[t]=e,void 0)},destroy:function(){var t=this.el,e=this.options;j.forEach(function(n){s(t,n.substr(2).toLowerCase(),e[n])}),s(t,"mousedown",this._onTapStart),s(t,"touchstart",this._onTapStart),s(t,"selectstart",this._onTapStart),s(t,"dragover",this._onDragOver),s(t,"dragenter",this._onDragOver),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),U.splice(U.indexOf(this._onDragOver),1),this._onDrop(),this.el=null}},e.utils={on:a,off:s,css:c,find:h,bind:i,is:function(t,e){return!!o(t,e,t)},throttle:v,closest:o,toggleClass:l,dispatchEvent:L,index:g},e.version="1.0.0",e.create=function(t,n){return new e(t,n)},t.fn.sortable=function(n){var i;return this.each(function(){var o=t(this),r=o.data("sortable");if(r||!(n instanceof Object)&&n||(r=new e(this,n),o.data("sortable",r)),r){if("widget"===n)return r;"destroy"===n?(r.destroy(),o.removeData("sortable")):n in r&&(i=r[r].apply(r,[].slice.call(arguments,1)))}}),void 0===i?this:i}});